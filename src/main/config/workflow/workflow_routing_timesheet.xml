<?xml version="1.0" encoding="UTF-8"?>

<!--
 Rice is the greatest framework of all time:

 Run these before re-ingesting changes to this document.

 delete from krew_rule_t where doc_typ_nm like 'TimesheetDocument';
 delete from krew_doc_typ_t where doc_typ_nm like 'TimesheetDocument';
-->
<data xmlns="ns:workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="ns:workflow resource:WorkflowData">
  <ruleAttributes xmlns="ns:workflow/RuleAttribute" xsi:schemaLocation="ns:workflow/RuleAttribute resource:RuleAttribute">
   <ruleAttribute>
      <name>TimesheetWorkareaSearchAttribute</name>
      <className>org.kuali.rice.kew.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
      <label>TimesheetWorkareaSearchAttribute</label>
      <description>TimesheetWorkareaSearchAttribute</description>
      <type>SearchableXmlAttribute</type>
      <searchingConfig>
        <fieldDef name="workarea" title="Work Area">
          <display>
            <type>text</type>
          </display>
          <fieldEvaluation>
            <xpathexpression>//WORKAREA/@value</xpathexpression>
          </fieldEvaluation>
        </fieldDef>
      </searchingConfig>
    </ruleAttribute>
   <ruleAttribute>
      <name>TimesheetDepartmentSearchAttribute</name>
      <className>org.kuali.rice.kew.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
      <label>TimesheetDepartmentSearchAttribute</label>
      <description>TimesheetDepartmentSearchAttribute</description>
      <type>SearchableXmlAttribute</type>
      <searchingConfig>
        <fieldDef name="department" title="Department">
          <display>
            <type>text</type>
          </display>
          <fieldEvaluation>
            <xpathexpression>//DEPARTMENT/@value</xpathexpression>
          </fieldEvaluation>
        </fieldDef>
      </searchingConfig>
    </ruleAttribute>   
    <ruleAttribute>
      <name>TimesheetSalGroupSearchAttribute</name>
      <className>org.kuali.rice.kew.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
      <label>TimesheetSalGroupSearchAttribute</label>
      <description>TimesheetSalGroupSearchAttribute</description>
      <type>SearchableXmlAttribute</type>
      <searchingConfig>
        <fieldDef name="salGroup" title="Salary Group">
          <display>
            <type>text</type>
          </display>
          <fieldEvaluation>
            <xpathexpression>//SALGROUP/@value</xpathexpression>
          </fieldEvaluation>
        </fieldDef>
      </searchingConfig>
    </ruleAttribute>
    <ruleAttribute>
      <name>TimesheetPayCalEndSearchAttribute</name>
      <className>org.kuali.rice.kew.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
      <label>TimesheetPayCalEndSearchAttribute</label>
      <description>TimesheetPayCalEndSearchAttribute</description>
      <type>SearchableXmlAttribute</type>
      <searchingConfig>
        <fieldDef name="payCalendarEnd" title="Pay Calendar End Date">
          <display>
            <type>text</type>
          </display>
          <fieldEvaluation>
            <xpathexpression>//PAYENDDATE/@value</xpathexpression>
          </fieldEvaluation>
        </fieldDef>
      </searchingConfig>
    </ruleAttribute>	
    <ruleAttribute>
        <name>TkWorkflowTimesheetAttribute</name>
        <className>org.kuali.hr.time.workflow.TkWorkflowTimesheetAttribute</className>
        <label>TkWorkflowTimesheetAttribute</label>
        <description>TkWorkflowTimesheetAttribute</description>
        <type>RuleAttribute</type>
    </ruleAttribute>    
	</ruleAttributes>
	
	<ruleTemplates xmlns="ns:workflow/RuleTemplate" xsi:schemaLocation="ns:workflow/RuleTemplate resource:RuleTemplate">
        <ruleTemplate allowOverwrite="true">
            <name>TkWorkflowTimesheetTemplate</name>
            <description>TkWorkflowTimesheetTemplate</description>
            <attributes>
                <attribute>
                    <name>TkWorkflowTimesheetAttribute</name>
                    <required>false</required>
                </attribute>
            </attributes>
        </ruleTemplate>
	</ruleTemplates>

   <documentTypes xmlns="ns:workflow/DocumentType" xsi:schemaLocation="ns:workflow/DocumentType resource:DocumentType">
        <documentType>
            <name>TimesheetDocument</name>
            <parent>RiceDocument</parent>
            <superUserWorkgroupName>TK_SYSTEM_ADMIN</superUserWorkgroupName>
      		<blanketApproveWorkgroupName>TK_SYSTEM_ADMIN</blanketApproveWorkgroupName>
      		<defaultExceptionWorkgroupName>TK_SYSTEM_ADMIN</defaultExceptionWorkgroupName>
            <description>TK Timesheet</description>
            <label>TK Timesheet</label>
            <attributes>
              <attribute>
                <name>TimesheetWorkareaSearchAttribute</name>
              </attribute>
              <attribute>
              	<name>TimesheetDepartmentSearchAttribute</name>
              </attribute>
              <attribute>
              	<name>TimesheetSalGroupSearchAttribute</name>
              </attribute>
              <attribute>
              	<name>TimesheetPayCalEndSearchAttribute</name>
              </attribute>
            </attributes>
            <postProcessorName>org.kuali.hr.time.workflow.postprocessor.TkPostProcessor</postProcessorName>
            <docHandler>${TK.DocHandlerPrefix}/Timesheet.do?methodToCall=docHandler</docHandler>
            <active>true</active>
            <routingVersion>1</routingVersion>
            <routePaths>
                <routePath>
                    <start name="adhoc" nextNode="Timesheet Attribute"/>
                    <requests name="Timesheet Attribute" />
                </routePath>
            </routePaths>
            <routeNodes>
                <start name="adhoc">
                    <exceptionWorkgroup>TK_SYSTEM_ADMIN</exceptionWorkgroup>
                    <activationType>S</activationType>
                    <mandatoryRoute>false</mandatoryRoute>
                    <finalApproval>false</finalApproval>
                </start>
                <requests name="Timesheet Attribute">
                    <exceptionWorkgroup>TK_SYSTEM_ADMIN</exceptionWorkgroup>
                    <activationType>S</activationType>
                    <ruleTemplate>TkWorkflowTimesheetTemplate</ruleTemplate>
                    <mandatoryRoute>true</mandatoryRoute>
                    <finalApproval>true</finalApproval>
                </requests>
            </routeNodes>
            <policies>
                <policy>
                    <name>INITIATOR_MUST_CANCEL</name>
                    <value>false</value>
                </policy>
                <policy>
                    <name>INITIATOR_MUST_ROUTE</name>
                    <value>false</value>
                </policy>
            </policies>
        </documentType>
     </documentTypes>


	<rules xmlns="ns:workflow/Rule" xsi:schemaLocation="ns:workflow/Rule resource:Rule">
	   <rule>
        <documentType>TimesheetDocument</documentType>
        <ruleTemplate>TkWorkflowTimesheetTemplate</ruleTemplate>
        <description>TkWorkflow</description>
        <forceAction>true</forceAction>
			<responsibilities>
				<responsibility>
                <role>org.kuali.hr.time.workflow.TkWorkflowTimesheetAttribute!TK_APPROVER</role>
                <approvePolicy>F</approvePolicy>
                <actionRequested>A</actionRequested>
                <priority>1</priority>
				</responsibility>
			</responsibilities>
    </rule>
 	</rules>

</data>